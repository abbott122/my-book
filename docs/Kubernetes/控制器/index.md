

在 Kubernetes 中，**控制器**是管理集群中各种资源的控制循环。它们通过观察集群的共享状态，然后尽可能地使当前状态与期望状态相符。

每个控制器都追踪一种或多种 Kubernetes 资源类型。这些资源可以是内置的，比如 Pod、Service 和 Deployment，也可以是自定义资源定义（CRD）。

### 控制器的工作原理

一个控制器通常执行以下步骤：

1.  **观察（Watch）**：控制器持续地观察集群的状态。它会监听 Kubernetes API 服务器发出的事件，比如资源的创建、更新或删除。
2.  **获取（Get）**：当接收到事件后，控制器会获取相关的资源对象，并分析其当前状态。
3.  **比较（Compare）**：控制器将资源的当前状态与用户在配置文件中定义的**期望状态**进行比较。
4.  **协调（Reconcile）**：如果当前状态与期望状态不符，控制器会采取行动来协调它们。例如，如果一个 Deployment 的期望副本数是 3，但当前只有 2 个 Pod 在运行，Deployment 控制器就会创建一个新的 Pod 来满足期望。

这个过程是一个**控制循环（Control Loop）**，它会不断地重复，确保集群始终保持在期望的状态。

---

### 常见的内置控制器

Kubernetes 有许多内置控制器，每个都负责管理特定类型的资源。以下是一些最常见的例子：

* **Deployment 控制器**：管理无状态 Pod 的集合。它负责确保 Pod 的副本数始终与期望值相符。
* **StatefulSet 控制器**：管理有状态的应用程序。它为 Pod 提供了唯一的、持久的身份，并确保它们以有序的方式启动和停止。
* **ReplicaSet 控制器**：确保在任何给定时间都有指定数量的 Pod 副本在运行。ReplicaSet 通常由 Deployment 控制器自动管理。
* **DaemonSet 控制器**：确保每个节点上都运行一个 Pod 副本。这对于运行集群级别的后台任务非常有用，比如日志收集或监控代理。
* **Job 控制器**：管理一次性或批处理任务。它负责运行 Pod 直到任务成功完成。
* **Service 控制器**：管理 Service 的生命周期，负责为 Pod 提供稳定的网络端点，并在后端 Pod 之间进行负载均衡。

---

### 为什么控制器很重要？

控制器是 Kubernetes **自我修复**和**自动化**能力的核心。它们将期望状态与当前状态的协调工作自动化，从而减轻了管理员的负担。

想象一下，如果没有控制器，当一个 Pod 崩溃时，你需要手动去创建新的 Pod。有了控制器，比如 Deployment，它会自动检测到 Pod 数量不足，并立即启动一个新的 Pod 来替代它，确保你的应用程序始终可用。

简单来说，**控制器是 Kubernetes 强大的驱动力，是它能够实现声明式 API 的关键。** 你只需要告诉 Kubernetes 你想要的最终状态是什么，而控制器则会负责处理实现这个状态的所有细节。

### 控制器详解

[Deployment 控制器](../控制器/Deployment/index.md)

[StatefulSet 控制器](../控制器/StatefulSet/index.md)

[ReplicaSet 控制器](../控制器/ReplicaSet/index.md)

[DaemonSet 控制器](../控制器/DaemonSet/index.md)

[Job 控制器](../控制器/Job/index.md)

[Service 控制器](../控制器/Service/index.md)